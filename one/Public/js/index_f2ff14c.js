define("user:page/assets/uplan/index",["require","exports","module","common:widget/ui/donut/donut","common:widget/oui/lib/handlebars/1.0.0/handlebars","common:widget/oui/common","common:widget/oui/rsa/index","common:widget/oui/protocol","common:widget/oui/widgets/widgets","common:widget/oui/arale/dialog/1.3.3/dialog","common:widget/oui/lib/jquery/1.9.1/jquery","common:widget/oui/widgets/list","common:widget/oui/components/components"],function(t,n,e){function i(t,n){c.get("/account/invest!rollOverInfo.action?subPointId="+t,function(t){if(0==t.status){var e={financePlanName:t.data.financePlanName,subPointId:t.data.subPointId,category:t.data.financePlanTemplate.category,lockPeriod:t.data.financePlanTemplate.lockPeriod,expectedRateUplan:s.translator._fixedFloat2(t.data.financePlanTemplate.expectedRateUplan),seniorDiscountRate:s.translator._fixedFloat2(t.data.seniorDiscountRate),discountRate:s.translator._fixedFloat2(t.data.discountRate),Rate:s.translator._fixedFloat2(t.data.discountRate+t.data.seniorDiscountRate),rollOverAmount:s.translator._fixedFloat2(t.data.rollOverAmount),lockDays:t.data.lockDays,financePlanId:t.data.financePlanId};o(e,n)}else alert(t.message)})}function o(t,n){var e=c("#confirm-uplan-roll-over-plans-template").html(),i=Handlebars.compile(e),o=i(t),a=new r({width:"700px"}).before("show",function(){this.set("content",o)}).after("hide",function(){n.index=0,a.element.remove()}).after("show",function(){m.ui.partInit(c("#J_ROLLOVER_FORM")),c("#J_ROLLOVER_FORM .ui-confirm-cancel-link").click(function(){a.hide(),a.element.remove()}),c("#J_ROLLOVER_FORM").submit(function(){var t=c('input[name="agree-contract"]'),n=c(".ui-confirm-agree-hint");if(0===c("#J_cashPassword2").val().length)return c("#J_ERROR_P_TX2").css("display","block"),!1;if(t.length>0){var e=t.prop("checked");if(!e)return n.text("投标前请阅读并同意协议"),n.show(),!1;n.hide()}c("#J_cashPassword2").val(l(c("#J_cashPassword2").val()))}),c("#J_cashPassword2").focus(function(){c("#J_ERROR_P_TX2").css("display","none")}),c("#addrate-agree").on("click",function(){var t=parseInt(100*c("#addRate").attr("data-seniorDiscountRate"),10),n=parseInt(100*c("#addRate").attr("data-discountRate"),10),e=(t+n)/100;c(this).prop("checked")?(c("#addRate").text("+"+e.toFixed(2)+"%"),c("#rollOverOrNot").val(2)):(c("#addRate").text("+"+(n/100).toFixed(2)+"%"),c("#rollOverOrNot").val(1))})}).show();c("#tipCon_1").length&&c("#tips_1").length&&(c("#tips_1").on("mouseleave",function(){c("#tipCon_1").hide()}),c("#tips_1").on("mousemove",function(){var t=c("#tips_1").offset().left-c("#J_ROLLOVER_FORM").offset().left+20;c("#tipCon_1").css("left",t+"px").show()})),c("#tipCon_2").length&&c("#tips_2").length&&(c("#tips_2").on("mouseleave",function(){c("#tipCon_2").hide()}),c("#tips_2").on("mousemove",function(){var t=c("#tips_2").offset().left-c("#J_ROLLOVER_FORM").offset().left+20;c("#tipCon_2").css("left",t+"px").show()}))}var a=(t("common:widget/ui/donut/donut"),t("common:widget/oui/lib/handlebars/1.0.0/handlebars"),t("common:widget/oui/common")),l=t("common:widget/oui/rsa/index"),s=t("common:widget/oui/protocol"),d=t("common:widget/oui/widgets/widgets"),r=t("common:widget/oui/arale/dialog/1.3.3/dialog"),c=t("common:widget/oui/lib/jquery/1.9.1/jquery"),u=(t("common:widget/oui/widgets/list"),t("common:widget/oui/components/components")),m=d.Form,n={init:function(){n.myUplanList(),c("#holding-list-filter").hover(function(){c("#holding-list-filter ul").show()},function(){c("#holding-list-filter ul").hide()}),c("#holding-list-filter li").on("click",function(){c(".filter-uplan").text(c(this).find("span").text())})},myUplanList:function(){new d.List({name:"holding-list",api:s.API.getUserHoldingPlans,title:!0,filter:!0,pagination:!0,rendered:function(){this.container.children("li.ui-list-item").each(function(t,n){new f({container:c(n)}).init()}),a.initPoptips(this.container)}}).init(a.loadJSON("#holding-list-rsp",!0)),new d.Tab({name:"plans",switched:function(t,n,e){return e?!0:("exiting"==n&&new d.List({name:"exiting-list",api:s.API.getUserExitingPlans,title:!0,pagination:!0,rendered:function(){this.container.find("span.quitBeforeTiggler").each(function(){c(this).data("content");c(this).hover(function(){c("#quitBeforeElement .ui-poptip-content").html(c(this).data("content")),c("#quitBeforeElement").css({position:"absolute",left:c(this).offset().left+22,top:c(this).offset().top-9,zIndex:99}).show()},function(){c("#quitBeforeElement").hide()})}),this.container.find("span.remainedTiggler").each(function(){c(this).data("content");c(this).hover(function(){c("#remainedElement .ui-poptip-content").html(c(this).data("content")),c("#remainedElement").css({position:"absolute",left:c(this).offset().left+22,top:c(this).offset().top-9,zIndex:99}).show()},function(){c("#remainedElement").hide()})})}}).init()._update(),"exited"==n&&new d.List({name:"exited-list",api:s.API.getUserExitedPlans,title:!0,pagination:!0,rendered:function(){a.initPoptips(this.container)}}).init()._update(),"reserve"==n&&new d.List({name:"reserve-list",api:s.API.getUserReservePlans,title:!0,pagination:!0,rendered:function(){a.initPoptips(this.container)}}).init()._update(),!0)}}).init()}},f=function(t){c.extend(this,{container:t.container,subPointid:"",handler:null,dialogExitExecution:null,dialogExit:null,_ui:{}})};c.extend(f.prototype,{init:function(){var t=this,n=this._ui;n.btn=t._elem("quit"),n.rollbtn=t._elem("rollOver"),n.rollbtn.index=0,n.btn.length>0&&(t.handler=new u.PlanQuitHandler({planName:t.container.data("plan-name"),subPointId:t.container.data("sub-point-id"),finalAmount:t.container.data("final-amount")}).init(),a.constant.QUIT_PLAN_DISABLED&&(n.btn.removeClass("cursor-pointer"),n.btn.addClass("quit-disabled")),n.btn.click(function(){a.constant.QUIT_PLAN_DISABLED||t.handler.start("exit")})),n.rollbtn.click(function(){0==n.rollbtn.index&&(n.rollbtn.index++,i(c(this).attr("data-subPointId"),n.rollbtn),c.get("/html/blank/blank.html?tag=3xuqilist",function(){}))})},_elem:function(t){return this.container.find('[data-name="'+t+'"]')}}),e.exports=n});