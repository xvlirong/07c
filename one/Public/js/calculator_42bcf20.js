define("invest:page/calculator/calculator",["require","exports","module","common:widget/oui/lib/jquery/1.9.1/jquery","common:widget/oui/arale/tip/1.1.4/tip","common:widget/oui/common","common:widget/oui/protocol","common:widget/oui/widgets/widgets","common:widget/oui/components/components","common:widget/oui/arale/dialog/1.3.3/dialog","common:widget/oui/lib/handlebars/1.0.0/handlebars"],function(t,o,a){var e=t("common:widget/oui/lib/jquery/1.9.1/jquery"),i=(t("common:widget/oui/arale/tip/1.1.4/tip"),t("common:widget/oui/common"),t("common:widget/oui/protocol")),n=t("common:widget/oui/widgets/widgets"),r=t("common:widget/oui/components/components"),s=(t("common:widget/oui/arale/dialog/1.3.3/dialog"),t("common:widget/oui/lib/handlebars/1.0.0/handlebars")),l=(n.GoTop(),e),u=i.translator,c=r.Calculator,m=n.Form,d=/^(([1-9]{1}\d*)|([0]{1}))?$/,p=e("#borrowAmount").data("range")||"";p=p.split(",");var h=""===p[0]?"出借金额50的倍数":"金额范围"+m.comma(p[0])+"-"+m.comma(p[1]);m.validate({before:function(){""!==p[0]?l.validator.addMethod("isBorrowAmount",function(t,o){return this.optional(o)||t>=parseInt(p[0],10)&&t<=parseInt(p[1],10)&&t%50===0&&d.test(t)},"借款金额范围"+p[0]+"-"+p[1]+"，且为50的倍数"):(l.validator.addMethod("isBorrowAmount",function(t,o){return this.optional(o)||t%50===0&&d.test(t)},"出借金额范围须为50的倍数"),l.validator.addMethod("isRepayDate",function(t,o){return this.optional(o)||t>0&&48>=t},"借款期限须为1-48个月")),l.validator.addMethod("istouziAmount",function(t,o){return this.optional(o)||t%1e3===0&&d.test(t)&&t>0},"投资金额范围须为1000的整数倍且不能为空"),l.validator.addMethod("isFixedAmount",function(t,o){return this.optional(o)||t>=500&&2e4>=t&&t%100===0&&d.test(t)},"金额500-20000元之间，且100的倍数"),l.validator.addMethod("isRateOver",function(t){var o=""===p[0]?5:10,a=24;return t=parseFloat(t),t>=o&&a>=t},m.err.isRateOver)},showTip:!0,tip:{fixedAmount:"500-20000元之间，100的倍数",borrowAmount:h,yearRate:""===p[0]?"利率范围5%-24%":"利率范围10%-24%",repayDate:""===p[0]?"可填写从1到48任意整数月份":null},validateData:{submitHandler:function(t){if("block"==e("#J_tab_loan").css("display")){var o=e("#calculate-tab").offset().top;o&&e("body,html").animate({scrollTop:o},800)}if("block"==e("#J_tab_fixed").css("display")){var o=e("#calculate-tab").offset().top;o&&e("body,html").animate({scrollTop:o},800);var a=e.trim(e("#fixedAmount").val());return month=e.trim(e("#isfixMonth").data("month")),s={},s.amount=a,s.repayTime=month,""===a||Number(a)%100!==0?(e("#fixedAmount").siblings(".ui-poptip").css("display","block"),!1):(e("#fixedAmount").siblings(".ui-poptip").css("display","none"),e.ajax({async:!1,type:"GET",url:"/calculate!calculateAutoInvestPlanInterest.action",data:s,dataType:"json",success:function(t){0===t.status&&"okay"===t.message?(e("#isFixAount").html(""+t.data.total+".00"),e("#isFixRate").html(""+t.data.rate+".00"),e("#isFixEarn").html(""+t.data.earn+".00")):(alert(t.message),e("#isFixAount").html("0.00"),e("#isFixRate").html("0.00"),e("#isFixEarn").html("0.00")),e("#J_tab_fixed .result-con").show()},error:function(){alert(resp.message),e("#isFixAount").html("0.00"),e("#isFixRate").html("0.00"),e("#isFixEarn").html("0.00"),e("#J_tab_fixed .result-con").show()}}),!1)}if("block"==e("#J_tab_uplan").css("display")){var i=e("#touziAmount").val();if(""===e.trim(i)||Number(i)%1e3!==0)return e("#touziAmount-error-label").css("display","block"),!1;e("#touziAmount-error-label").css("display","none");var o=e("#calculate-tab").offset().top;o&&e("body,html").animate({scrollTop:o},800);var n=e("#calcForm1").serializeArray(),r=c.arrToObj(n),s={};return s.amount=r.touziAmount,s.cashType=r.rType,s.category=r.UType,e.ajax({async:!1,type:"GET",url:"/calculate!calculateUplanInterest.action",data:s,dataType:"json",success:function(t){0===t.status&&"okay"===t.message?(e("#J_CJJE").html(""+r.touziAmount+".00"),e("#J_YQSY").html(""+Number(t.data.interest).toFixed(2))):(alert(t.message),e("#J_CJJE").html(""+r.touziAmount+".00"),e("#J_YQSY").html("0.00")),e("#J_tab_uplan .result-con").show()},error:function(){alert(resp.message),e("#J_CJJE").html(""+r.touziAmount+".00"),e("#J_YQSY").html("0.00"),e("#J_tab_uplan .result-con").show()}}),!1}return"借款设置"==e(".J_tit").text()&&""===e("#repayDate").attr("value")?(e(".noinput-p").css("display","block"),!1):(f(),void b(t))}}}),e("#calcForm1").validate({rules:{touziAmount:{required:!0,istouziAmount:!0}},messages:{touziAmount:{required:m.err.required}}}),e("#calcFormFixed").validate({rules:{fixedAmount:{required:!0,isFixedAmount:!0}},messages:{fixedAmount:{required:m.err.required}}}),""===p[0]&&e("#repayDate").rules("add",{required:!0,isIntNum:!0,isRepayDate:!0,messages:{required:m.err.required,isIntNum:m.err.isIntNum}});var f=function(){var t,o,a,i;o=e("#ratetable tbody tr"),t=e.trim(e("#borrowAmount").val()),a=o.eq(0).find("td").filter(function(){return"服务费率"!=e(this).text()}),i=o.eq(1).find("td").filter(function(){return"服务费用"!=e(this).text()}),!t||t%50!==0||t>1e6?e.each(a,function(t){i.eq(t).html("")}):e.each(a,function(o){var a=parseFloat(e(this).text().replace("%",""));i.eq(o).html((a*t*.01).toFixed(0))}),e("#J_sjfy").css("color","#383838")},b=function(t){var o=e(t).serializeArray(),a=c(c.arrToObj(o)),i=a.calc();i.borrowAmount=""==e.trim(e("#borrowAmount").val())?0:e.trim(e("#borrowAmount").val()),i.gain=0,e.each(i.table,function(t,o){i.gain+=parseFloat(o.mlixi)}),i.gain=u._fixedFloat2(i.gain),i.monthlyRepayB=u._fixedFloat2(i.monthlyRepay+.003*i.borrowAmount),i.mounthRate=u._fixedFloat2(i.mounthRate),i.monthlyRepay=isNaN(i.monthlyRepay)?"0.00":u._fixedFloat2(i.monthlyRepay),i.borrowAmount=u._fixedFloat2(i.borrowAmount),a=null;var n=e("#loan-calc").html(),r=s.compile(n),l=e(".J_tit").eq(0).text();i.isShowTable="借款设置"==l&&"false"==i.isShowTable?!1:!0,"理财计算器 "==l&&(i.isShowTable=e("#isShowTable").is(":checked"));var m=r(i);if(e("#calcResult").html(m),e("#J_BJLX").html("<span>本金及利息</span><em>￥"+u._commaFloat(i.monthlyRepay)+"</em>&nbsp;&nbsp;(支付给理财人)"),e("#J_JKGLF").html("<span>借款管理费</span><em>￥"+u._commaFloat(.003*i.borrowAmount)+"</em>&nbsp;&nbsp;(由人人贷平台收取)"),"借款设置"==e(".J_tit").text()){var d=e("#calcForm").offset();e("body,html").animate({scrollTop:d.top},0)}e("#J_tab_loan .result-con").show()};e(document).click(function(t){var o=t.target;e(o).parent("span").hasClass("arrow")||(e(o).parent("div").hasClass("J_select_btn")||e(".J_popBox").css("display","none"),"touziAmount"!=e(o).attr("id")&&e("#J_touziAmount_hint").css("display","none"))}),e(".J_select_btn").click(function(t){e(".J_popBox").css("display","none");var o=e(t.currentTarget).parent().find("ul");"block"==o.css("display")?o.css("display","none"):o.css("display","block")}),e(".J_popBox li").mouseover(function(t){e(t.currentTarget).attr("class","selected")}),e(".J_popBox li").mouseleave(function(t){e(t.currentTarget).attr("class","")}),e(".J_popBox li").click(function(t){var o,a=e(t.currentTarget).attr("datavalue"),i=e(t.currentTarget).find("span").text(),n=e(t.currentTarget).parent().parent(),r={3:10,6:11,9:12,12:12,15:13,18:13,24:13,36:13};return n.find("input").attr("value",a),n.find(".J_txt").text(i),"RRGXD"==a||"RRSYD"==a||"RRWSD"==a?(location.href="/borrow/calculator.action?prodType="+a,!1):(e(".noinput-p").css("display","none"),void(a&&r[a]&&(o=r[a],e("#yearRate").val(o).parent().find(".error-p").css("display","none"))))}),e("#touziAmount").on("click",function(){e("#J_touziAmount_hint").css("display","block")}),e("#yearRate,#borrowAmount,.error-p").on("click",function(t){e(t.currentTarget).parent().find(".error-p").css("display","none")}),e(".J_ui_checkbox").bind("click",function(t){var o=e(t.currentTarget);o.hasClass("uncheck")?(o.removeClass("uncheck"),o.addClass("check"),e("#isShowTable").attr("value","true")):(o.removeClass("check"),o.addClass("uncheck"),e("#isShowTable").attr("value","false"))});var y={init:function(){new n.Tab({name:"calculate",switched:function(){}}).init()}};a.exports=y});