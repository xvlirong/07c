define("invest:page/autoinvestplan/details/autoinvestplan",["require","exports","module","common:widget/oui/lib/jquery/1.9.1/jquery","common:widget/oui/arale/tip/1.1.4/tip","common:widget/oui/common","common:widget/oui/protocol","common:widget/oui/widgets/widgets","common:widget/oui/components/components","common:widget/oui/arale/dialog/1.3.3/dialog","common:widget/oui/lib/handlebars/1.0.0/handlebars","invest:widget/static/js/invest-commom"],function(t,e,i){function n(){var t=r("#pg-helper-success-hint").html(),e=r("#pg-helper-fail-hint").html();if(t){var i=r.parseJSON(t);i&&(h.succeeMsg({title:"加入成功",planName:i.data.planName,lockPeriod:i.data.lockPeriod,finalAmount:i.data.finalAmount,labels:i.data.labels}),r(".J_target-list li").not(".target-ipt").on("click",function(){r(".J_target-list li").not(".target-ipt").removeClass("active"),r(this).addClass("active"),r("input[name='tagStr']").val(r(this).text()),r(this).hasClass("J_author-target")?r(".target-ipt").removeClass("fn-hide"):r(".target-ipt").addClass("fn-hide")}),r(".ui-message-sure-button").click(function(){if(r(".J_author-target").hasClass("active"))if(""==r(".target-ipt input").val())r("input[name='tagStr']").val("薪");else{if(r(".target-ipt input").val().length>64)return void r(".target-error").text("标签不能超过64个字").show();r("input[name='tagStr']").val(r(".target-ipt input").val())}r("input[name='tagStr']").val()?r.ajax({url:"/autoinvestplan/customNameAutoInvestPlan.action",type:"POST",data:{autoInvestPlanIdStr:r("input[name='autoInvestPlanSubPointIdStr']").val(),tagStr:r("input[name='tagStr']").val()},success:function(t){1==t.status?r(".target-error").text(t.message).show():location.reload()}}):location.reload()}))}if(e){var n=r.parseJSON(e);n&&h.failedMsg({title:"失败",failMsg:n.data.message})}{var a,o="true"==r("#authenticated").text(),s="true"==r("#pg-helper-is-investor").text(),g=r("#pg-helper-be-investor-message").html();parseFloat(r("#max-account").data("account"),10)}if(r("#pg-helper-has-withdraw-password").length>0){var v="true"==r("#pg-helper-has-withdraw-password").text();s=v&&s}var f,w,b={container:r("#investment-terminal"),authenticated:o,qualified:s,qualifiedMessage:g},j=r("#plan-status").text(),f=parseInt(r("#max-amount-1").data("amount"),10),x=parseInt(r("#min-amount-1").data("amount"),10);if(w=r("#share-amount").attr("data-share-amount"),r.extend(b,{plan:{status:j},page:"autoinvest-join",unit:"amount",template:r("#confirm-autoinvest-in-template"),amountPerShare:w,maxAmount:f,minAmount:x}),new d.InvestmentTerminal(b).init(),r("#autoinvest-basic").length>0){var I=r("#autoinvest-basic-products").data("products").split(","),_={};r.each(I,function(t,e){e=r.trim(e),"信用认证标"==e||"信用标"==e?_.XYRZ="信用认证标":"机构担保标"==e?_.JGDB=e:"实地认证标"==e?_.SDRZ=e:"智能理财标"==e&&(_.ZNLC=e)}),a={products:[]},r.each(_,function(t,e){a.products.push({product:t,productName:e})}),u.fillTemplate({container:r("#autoinvest-basic-products"),template:r("#autoinvest-basic-products-template"),data:a});var P=r("#plan-begin-selling-time").data("time");P&&r("#plan-begin-selling-time").text(P.substring(0,19))}var C=function(t,e,i){var n=new m.List({name:t,api:e,title:!0,params:i,container:r("#"+t+"-records"),rendered:function(t){{var i=t.status,n=t.data;c.translator}if(0===i&&e==c.API.getAutoinvestJoinedRecords){r("#joined-count").text(n.jsonList.length);var a=0;r.each(n.jsonList,function(t,e){a+=Number(e.amount.replace(/,/g,""))});var o=Math.round(100*a/n.jsonList.length)/100;0==n.jsonList.length&&(o=0),r("#reserve-had-pay-amount").html(o)}}}).init();return n._update(n.getParams()),n};if(r("#autoinvest-basic").length>0){var S=r("#pg-helper-plan-id").text(),A=null,T=null;new m.Tab({name:"autoinvest",switched:function(t,e,i){return i?!0:("joined"==e&&(A=C("joined",c.API.getAutoinvestJoinedRecords,{autoInvestPlanId:S})),!0)},clicked:function(t,e){T||"joined"==t&&e&&A&&A._update(A.getParams()),T=window.setTimeout(function(){window.clearTimeout(T),T=null},750)}}).init()}r("#tipCon").length&&r("#tips").length&&new l({element:"#tipCon",trigger:"#tips",direction:"right"}),r("#tipCon_0").length&&r("#tips_0").length&&new l({element:"#tipCon_0",trigger:"#tips_0",direction:"right"}),r("#tipCon_1").length&&r("#tips_1").length&&new l({element:"#tipCon_1",trigger:"#tips_1",direction:"right"}),p.ticksownTime("#J_WAIT_BUTTON")}function a(){o()}function o(){s()}function s(){new m.List({name:"autoinvest-list",api:c.API.getAutoinvestPlans,filter:!1,header:!0,pagination:!1,rendered:null}).init()._update()}var r=t("common:widget/oui/lib/jquery/1.9.1/jquery"),l=t("common:widget/oui/arale/tip/1.1.4/tip"),u=t("common:widget/oui/common"),c=t("common:widget/oui/protocol"),m=t("common:widget/oui/widgets/widgets"),d=t("common:widget/oui/components/components"),g=t("common:widget/oui/arale/dialog/1.3.3/dialog"),p=(t("common:widget/oui/lib/handlebars/1.0.0/handlebars"),m.GoTop(),t("invest:widget/static/js/invest-commom")),h={isIE6:function(){var t=(window.navigator.userAgent||"").toLowerCase();return-1!==t.indexOf("msie 6")},succeeMsg:function(t,e,i){var n,a=r("#joined-succee-message");a.length<1||(t="string"==typeof t?{message:t}:t,n=u.fillTemplate({template:a,data:t}),this.isIE6()?(r(".pg-container-content").prepend(n),r(".ui-message-close-button").click(function(){r(".ui-message-content").remove()})):new g({content:n}).after("hide",function(){this.destroy(),e&&r.isFunction(e)&&e.call(this)}).after("show",function(){var t=this;r(".ui-message-close-button").click(function(){t.hide()}),i&&r.isFunction(i)&&i.call(this)}).show())},failedMsg:function(t,e,i){var n,a=r("#joined-failed-message");a.length<1||(t="string"==typeof t?{message:t}:t,n=u.fillTemplate({template:a,data:t}),this.isIE6()?(r(".pg-container-content").prepend(n),r(".ui-message-close-button").click(function(){r(".ui-message-content").remove()})):new g({content:n}).after("hide",function(){this.destroy(),e&&r.isFunction(e)&&e.call(this)}).after("show",function(){var t=this;r(".ui-message-close-button").click(function(){t.hide()}),i&&r.isFunction(i)&&i.call(this)}).show())}},v={basic:n,details:a};i.exports=v});