define("invest:page/uplan/detail/detail",["require","exports","module","common:widget/oui/lib/jquery/1.9.1/jquery","common:widget/oui/arale/tip/1.1.4/tip","common:widget/oui/common","common:widget/oui/protocol","common:widget/oui/widgets/widgets","common:widget/oui/components/components","common:widget/oui/arale/dialog/1.3.3/dialog","common:widget/oui/lib/handlebars/1.0.0/handlebars"],function(t,e,a){function n(){var t=o("#pg-helper-success-hint").html();if(t){var e=null;try{e=o.parseJSON(t)}catch(a){e=null}e&&l.showMessage2({title:"U计划预定成功！",depositAmount:e.data.depositAmount,endPaymentTime:e.data.endPaymentTime,overplusAmount:e.data.overplusAmount,button:{link:"/account/invest!plan.action?planTab=RESERVATIONS",text:"立即支付"}})}var n,i="true"==o("#authenticated").text(),d="true"==o("#pg-helper-is-investor").text(),g=o("#pg-helper-be-investor-message").html(),h=o("#fullTime"),f=o("#university");if(h.length){var v=h.data("time"),w=v.match(/(\d+)天/);w=null!==w?Number(w[1]):w;var I=v;I=w>0?v.split("分")[0]+"分":v.split("天")[1],I=I.replace(/(\d)+/g,function(t){return"<i class='num-family font-30px'>"+t+"</i>"}),h.html(I)}if(f.length){var T=f.data("data");f.html(T.length?T.length>6?T.substring(0,6)+"...":T:"--")}var _=o("#counter");_.length>0&&(new c.Counter({container:_,delta:parseInt(_.data("delta"),10)}).init(),o("#counter").hasClass("ui-counter-seconds")||o("#counter").parent().children(".suffix").show());parseFloat(o("#max-account").data("account"),10);if(o("#pg-helper-has-withdraw-password").length>0){var b="true"==o("#pg-helper-has-withdraw-password").text();d=b&&d}var x,A,P={container:o("#investment-terminal"),authenticated:i,qualified:d,qualifiedMessage:g};if(o("#pg-plan-join, #pg-plan-index").length>0){var N=o("#plan-status").text(),J=parseInt(o("#max-amount-1").data("amount"),10),j=parseInt(o("#max-amount-2").data("amount"),10);x=J>j?j:J,A=o("#share-amount").attr("data-share-amount");var C=parseFloat(o("#fee-rate").data("fee-rate"),10)/100,y=parseFloat(o("#deposit-rate").data("deposit-rate"),10)/100,R=Number(o("#J_thisMaxDepositAmount").attr("data")),S=Number(o("#J_maxDepositAmount").attr("data"));y>R?y=R:y>S&&(y=S);var k;switch(N){case"RSV":k=o("#confirm-plan-reserve-template");break;case"UCODE":k=o("#use-ucode-join-template");break;default:k=o("#confirm-plan-join-template")}o.extend(P,{plan:{status:N},page:"plan-join",unit:"amount",template:k,amountPerShare:A,maxAmount:x,maxShares:x/A,fee:C,deposit:y})}if(new m.InvestmentTerminal(P).init(),o("#plan-basic").length>0){var O=o("#plan-basic-products").data("products").split(","),U={};if(o.each(O,function(t,e){e=o.trim(e),"信用认证标"==e||"信用标"==e?U.XYRZ="信用认证标":"机构担保标"==e?U.JGDB=e:"实地认证标"==e?U.SDRZ=e:"智能理财标"==e&&(U.ZNLC=e)}),n={products:[]},o.each(U,function(t,e){n.products.push({product:t,productName:e})}),l.fillTemplate({container:o("#plan-basic-products"),template:o("#plan-basic-products-template"),data:n}),i){var B=p.translator.translate(p.API.getUserBankInfo,l.loadJSON("#account-info-rsp",!0).data);l.fillTemplate({container:o("#select-bank-accounts"),template:o("#select-bank-accounts-template"),data:B})}var q=o("#plan-begin-selling-time").data("time");q&&o("#plan-begin-selling-time").text(q.substring(0,19))}if(o("#plan-details").length>0){var L=o("#pg-helper-plan-id").text(),W=null,D=null;new c.Tab({name:"plan",switched:function(t,e,a){return a?!0:("reserve"==e&&(W=u("reserve",p.API.getPlanReserveRecords,{financePlanStr:L})),"joined"==e&&(W=u("joined",p.API.getPlanJoinedRecords,{financePlanStr:L})),"performance"==e&&new m.PlanPerformance({name:"performance",planId:L}).init(),!0)},clicked:function(t,e){D||"joined"==t&&e&&W&&W._update(W.getParams()),D=window.setTimeout(function(){window.clearTimeout(D),D=null},750)}}).init()}o("#tipCon").length&&o("#tips").length&&new s({element:"#tipCon",trigger:"#tips",direction:"right"}),o("#tipCon_0").length&&o("#tips_0").length&&new s({element:"#tipCon_0",trigger:"#tips_0",direction:"right"}),o("#tipCon_1").length&&o("#tips_1").length&&new s({element:"#tipCon_1",trigger:"#tips_1",direction:"right"}),o("#tipCon_2").length&&o("#tips_2").length&&new s({element:"#tipCon_2",trigger:"#tips_2",direction:"down",arrowShift:-22}),r(),o(".J_click_p").on("click",function(t){var e="P"==o(t.target).get(0).tagName?o(t.target).attr("data"):o(t.target).parent(".J_click_p").attr("data");location.href="/financeplan/"+e})}function i(t,e,a){var n=parseInt(t,10),i=0,r=0,s=0;n>60&&(i=parseInt(n/60,10),n=parseInt(n%60,10),i>60&&(r=parseInt(i/60,10),i=parseInt(i%60,10)),r>24&&(s=parseInt(r/24,10),r=parseInt(r%24,10)));var l="",p="";l=s>0?""+parseInt(s,10)+"天"+parseInt(r,10)+"时":r>0?""+parseInt(r,10)+"时"+parseInt(i,10)+"分":parseInt(i,10)+"分"+parseInt(n,10)+"秒","#J_WAIT_BUTTON"==e&&(l="",l=s>0?""+parseInt(s,10)+"天"+parseInt(r,10)+"时"+parseInt(i,10)+"分":""+parseInt(r,10)+"时"+parseInt(i,10)+"分"+parseInt(n,10)+"秒",o(e).css("letter-spacing","0"),"0"===a&&(p="后开始预定"),"3"===a&&(p="开始加入"),l=l.replace(/(\d)+/g,function(t){return"<i class='num-family font-30px'>"+t+"</i>"}),o(e).html(l),o("#J_WAIT_BUTTON_TEXT")&&o("#J_WAIT_BUTTON_TEXT").html(p))}function r(){var t="#J_WAIT_BUTTON";if(o(t).length<=0||"3"!==o(t).attr("data")&&"0"!==o(t).attr("data")||"-1"===o(t).attr("data1"))return!1;var e=o(t).attr("data1"),a=setInterval(function(){e-=1,i(e,"#J_WAIT_BUTTON",o("#J_WAIT_BUTTON").attr("data")),0>=e&&(clearInterval(a),location.reload())},1e3)}var o=t("common:widget/oui/lib/jquery/1.9.1/jquery"),s=t("common:widget/oui/arale/tip/1.1.4/tip"),l=t("common:widget/oui/common"),p=t("common:widget/oui/protocol"),c=t("common:widget/oui/widgets/widgets"),m=t("common:widget/oui/components/components"),u=(t("common:widget/oui/arale/dialog/1.3.3/dialog"),t("common:widget/oui/lib/handlebars/1.0.0/handlebars"),c.GoTop(),function(t,e,a){var n=new c.List({name:t,api:e,title:!0,params:a,container:o("#"+t+"-records"),rendered:function(t){{var a=t.status,n=t.data;p.translator}if(0===a&&e==p.API.getPlanJoinedRecords){o("#joined-count").text(n.jsonList.length);var i=0;o.each(n.jsonList,function(t,e){i+=Number(e.amount.replace(/,/g,""))}),o("#reserve-had-pay-amount").html(i)}if(0===a&&e==p.API.getPlanReserveRecords){var r=0;o.each(n.rsvList,function(t,e){"未支付"==e.status&&(r+=e.planAmountNotComma)}),o("#reserve-not-pay-amount").html(r),o("#reserve-count").text(n.rsvList.length)}}}).init();return n._update(n.getParams()),n}),d={init:n};a.exports=d});